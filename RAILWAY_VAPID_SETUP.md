# Railway VAPID Keys Setup Guide

## Problem
The production deployment in Railway is failing with error: `layout-f334a69a11cf01f7.js:1 where the StartupProvider reports missing environment variable NEXT_PUBLIC_VAPID_PUBLIC_KEY`

## Root Cause
The `NEXT_PUBLIC_VAPID_PUBLIC_KEY` environment variable is missing from Railway's environment configuration. This key is required for push notifications functionality.

## Solution

### Step 1: Generate VAPID Keys

Run the following command locally to generate VAPID keys:

```bash
npx web-push generate-vapid-keys
```

This will output something like:
```
Public Key: BIXzZ5D9f5Y8K2m3n4p5q6r7s8t9u0v1w2x3y4z5A6B7C8D9E0F1G2H3I4J5K6L7M8N9O0P1Q2R3S4T5U6V7W8X9Y0Z1
Private Key: 4mXG9k8mZ8f9n0o1p2q3r4s5t6u7v8w9x0y1z2A3B4C5D6E7F8G9H0I1J2K3L4M5N6O7P8Q9R0S1T2U3V4W5X6Y7Z8
```

### Step 2: Configure Railway Environment Variables

1. Go to your Railway project dashboard
2. Navigate to **Variables** tab
3. Add the following environment variables:

#### Required Variables:
```
NEXT_PUBLIC_VAPID_PUBLIC_KEY=your-generated-public-key
VAPID_PRIVATE_KEY=your-generated-private-key
VAPID_CONTACT_EMAIL=admin@yourdomain.com
```

#### Example with actual values:
```
NEXT_PUBLIC_VAPID_PUBLIC_KEY=BIXzZ5D9f5Y8K2m3n4p5q6r7s8t9u0v1w2x3y4z5A6B7C8D9E0F1G2H3I4J5K6L7M8N9O0P1Q2R3S4T5U6V7W8X9Y0Z1
VAPID_PRIVATE_KEY=4mXG9k8mZ8f9n0o1p2q3r4s5t6u7v8w9x0y1z2A3B4C5D6E7F8G9H0I1J2K3L4M5N6O7P8Q9R0S1T2U3V4W5X6Y7Z8
VAPID_CONTACT_EMAIL=admin@yourdomain.com
```

### Step 3: Redeploy Application

After setting the environment variables:

1. Go to your Railway deployment
2. Click **Redeploy** to apply the new environment variables
3. Monitor the deployment logs for any errors

### Step 4: Verify Setup

You can verify the setup by:

1. Checking the Railway deployment logs
2. Accessing the `/api/test-env` endpoint to confirm variables are loaded:
   ```
   https://your-app.railway.app/api/test-env
   ```

3. The response should show:
   ```json
   {
     "message": "Environment Variables Test",
     "variables": {
       "NEXT_PUBLIC_VAPID_PUBLIC_KEY": "SET",
       "VAPID_PRIVATE_KEY": "SET",
       "VAPID_CONTACT_EMAIL": "SET"
     }
   }
   ```

## Alternative: Disable Push Notifications (if not needed)

If you don't need push notifications, you can modify the StartupProvider to treat missing VAPID keys as warnings instead of errors. However, this is not recommended as it disables a key feature.

## Troubleshooting

### Common Issues:

1. **Keys too short/long**: Ensure you're using the full keys generated by web-push
2. **Missing contact email**: VAPID_CONTACT_EMAIL is also required
3. **Invalid email format**: Use a valid email address for VAPID_CONTACT_EMAIL
4. **Case sensitivity**: Ensure exact case for environment variable names

### Debug Commands:

```bash
# Test environment variables locally
npm run validate:env

# Build with validation
npm run validate:build

# Check current environment
node -e "console.log(process.env.NEXT_PUBLIC_VAPID_PUBLIC_KEY)"
```

## Security Notes

- Keep VAPID_PRIVATE_KEY secure and never expose it in client-side code
- Use different keys for different environments (development, staging, production)
- Consider using Railway's secret management for additional security
- Rotate keys periodically for better security

## Support

If issues persist:
1. Check Railway logs for detailed error messages
2. Verify all required environment variables are set
3. Ensure the deployment is using the latest environment variables
4. Contact support with deployment logs if needed